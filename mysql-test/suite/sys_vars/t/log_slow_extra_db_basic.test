--echo # Bug#106645: Slow query log is not logging database/schema name.
--echo
--echo # test global variable "log_slow_extra_db"
--echo

SELECT @@global.log_slow_extra_db INTO @old_lsed;
SELECT @@global.log_output        INTO @old_lo;
SELECT @@global.slow_query_log    INTO @old_sql;

--echo # invalid values / types

--error ER_WRONG_VALUE_FOR_VAR
SET GLOBAL log_slow_extra_db=symbol;

--error ER_WRONG_VALUE_FOR_VAR
SET GLOBAL log_slow_extra_db="string";

--error ER_WRONG_VALUE_FOR_VAR
SET GLOBAL log_slow_extra_db=99;

--error ER_WRONG_TYPE_FOR_VAR
SET GLOBAL log_slow_extra_db=0.5;

--echo
--echo # only GLOBAL scope is valid

--error ER_GLOBAL_VARIABLE
SET SESSION log_slow_extra_db=0;

--echo

--echo # valid values
SET GLOBAL slow_query_log=0;

SET GLOBAL log_slow_extra_db=0;
SELECT @@global.log_slow_extra_db;

SET GLOBAL log_slow_extra_db=1;
SELECT @@global.log_slow_extra_db;

SET GLOBAL log_slow_extra_db=OFF;
SELECT @@global.log_slow_extra_db;

SET GLOBAL log_slolog_slow_extra_db_extra=ON;
SELECT @@global.log_slow_extra_db;

SET GLOBAL log_slow_extra_db=DEFAULT;
SELECT @@global.log_slow_extra_db;

--echo

--echo # warnings and errors

SET GLOBAL slow_query_log=1;
--echo

--echo # Switching slow query log file format while target is not FILE is legal,
--echo # but does nothing. Throw a warning!
SET GLOBAL log_output="TABLE";
SELECT @@global.log_slow_extra_db INTO @old;
SET GLOBAL log_slow_extra_db=1;
--echo # Value must have changed:
SELECT @@global.log_slow_extra_db!=@old;
SET GLOBAL log_slow_extra_db=DEFAULT;
--echo

--echo # Switching slow query log file format while target is not FILE is legal,
--echo # but does nothing. Throw a warning!
SET GLOBAL log_output="NONE";
SELECT @@global.log_slow_extra_db INTO @old;
SET GLOBAL log_slow_extra_db=1;
--echo # Value must have changed:
SELECT @@global.log_slow_extra_db!=@old;
SET GLOBAL log_slow_extra_db=DEFAULT;
--echo

--echo # clean up
SET GLOBAL log_slow_extra_db=@old_lsed;
SET GLOBAL log_output=@old_lo;
SET GLOBAL slow_query_log=@old_sql;
TRUNCATE TABLE mysql.general_log;
TRUNCATE TABLE mysql.slow_log;

--echo

--echo # READY
