# Bug#106645: Slow query log is not logging database/schema name.

# test global variable "log_slow_extra_db"

SELECT @@global.log_slow_extra_db INTO @old_lsed;
SELECT @@global.log_output        INTO @old_lo;
SELECT @@global.slow_query_log    INTO @old_sql;
# invalid values / types
SET GLOBAL log_slow_extra_db=symbol;
ERROR 42000: Variable 'log_slow_extra_db' can't be set to the value of 'symbol'
SET GLOBAL log_slow_extra_db="string";
ERROR 42000: Variable 'log_slow_extra_db' can't be set to the value of 'string'
SET GLOBAL log_slow_extra_db=99;
ERROR 42000: Variable 'log_slow_extra_db' can't be set to the value of '99'
SET GLOBAL log_slow_extra_db=0.5;
ERROR 42000: Incorrect argument type to variable 'log_slow_extra_db'

# only GLOBAL scope is valid
SET SESSION log_slow_extra_db=0;
ERROR HY000: Variable 'log_slow_extra_db' is a GLOBAL variable and should be set with SET GLOBAL

# valid values
SET GLOBAL slow_query_log=0;
SET GLOBAL log_slow_extra_db=0;
SELECT @@global.log_slow_extra_db;
@@global.log_slow_extra_db
0
SET GLOBAL log_slow_extra_db=1;
SELECT @@global.log_slow_extra_db;
@@global.log_slow_extra_db
1
SET GLOBAL log_slow_extra_db=OFF;
SELECT @@global.log_slow_extra_db;
@@global.log_slow_extra_db
0
SET GLOBAL log_slow_extra_db=ON;
SELECT @@global.log_slow_extra_db;
@@global.log_slow_extra_db
1
SET GLOBAL log_slow_extra_db=DEFAULT;
SELECT @@global.log_slow_extra_db;
@@global.log_slow_extra_db
1

# warnings and errors
SET GLOBAL slow_query_log=1;

# Switching slow query log file format while target is not FILE is legal,
# but does nothing. Throw a warning!
SET GLOBAL log_output="TABLE";
SELECT @@global.log_slow_extra_db INTO @old;
SET GLOBAL log_slow_extra_db=0;
Warnings:
Warning	3795	slow query log file format changed as requested, but setting will have no effect when not actually logging to a file.
# Value must have changed:
SELECT @@global.log_slow_extra_db!=@old;
@@global.log_slow_extra_db!=@old
1
SET GLOBAL log_slow_extra_db=DEFAULT;
Warnings:
Warning	3795	slow query log file format changed as requested, but setting will have no effect when not actually logging to a file.

# Switching slow query log file format while target is not FILE is legal,
# but does nothing. Throw a warning!
SET GLOBAL log_output="NONE";
SELECT @@global.log_slow_extra_db INTO @old;
SET GLOBAL log_slow_extra_db=0;
Warnings:
Warning	3795	slow query log file format changed as requested, but setting will have no effect when not actually logging to a file.
# Value must have changed:
SELECT @@global.log_slow_extra_db!=@old;
@@global.log_slow_extra_db!=@old
1
SET GLOBAL log_slow_extra_db=DEFAULT;
Warnings:
Warning	3795	slow query log file format changed as requested, but setting will have no effect when not actually logging to a file.

# clean up
SET GLOBAL log_slow_extra_db=@old_lsed;
Warnings:
Warning	3795	slow query log file format changed as requested, but setting will have no effect when not actually logging to a file.
SET GLOBAL log_output=@old_lo;
SET GLOBAL slow_query_log=@old_sql;
TRUNCATE TABLE mysql.general_log;
TRUNCATE TABLE mysql.slow_log;

# READY
